<html>
  <body>
    hello world
    
    
    <button class="generate">
      Generate Invoice
    </button>
  </body>

  
  <script src="https://cnguyen.bp:8088/bitpay.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js"
          integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg=="
          crossorigin="anonymous"></script>

  <script>
    const bitpayButton = document.querySelector('.generate');

    bitpayButton.addEventListener('click', generateInvoice);

    async function generateInvoice(event) {
      event.preventDefault();

      const price = 123 || document.getElementById('invoicePrice').value;
      const redirectURL = 'https://cnguyen812.github.io/scratch';
      const invoice = {
          currency: 'USD',
          price,
          token: '2JnYjXgKtFEe9PHpjSXyZejAtWenG3VGctfQskuTsZmS',
          itemDesc: `Heffalumps and Woozles`,
          orderId: '12345',
          redirectURL
      };
      const headers = {
        headers: {
          'Content-Type': 'application/json',
          'x-accept-version': '2.0.0'
        }
      };
      try {
        const { data } = await axios.post('https://cnguyen.bp:8088/invoice', invoice, headers);
        const id = data["id"];
        showInvoice(id);
      } catch (err) {
        console.error(err);
      }
    };

    function showSnackbar(status) {
        const snackbar = document.getElementById('snackbar');
        // Add the 'show' class to DIV
        snackbar.className = `${status} show`;
        snackbar.innerText = `${status}`;
        // After 3 seconds, remove the show class from DIV
        setTimeout(function () {
            snackbar.className = snackbar.className.replace(`${status} show`, '');
        }, 3000);
    }

    function showInvoice(id) {
        let is_paid = false
        window.addEventListener("message", function (event) {
            payment_status = event.data.status;
            if (payment_status == "paid") {
                is_paid = true
                showSnackbar('success');
                //take action PAID
                return;
            }
        }, false);
        //show the order info
        bitpay.onModalWillLeave(function () {
            if (is_paid == false) {
                showSnackbar('fail');
                //take action, NOT PAID
            } //endif
        });
        //show the modal
        bitpay.setApiUrlPrefix('https://cnguyen.bp:8088');
        bitpay.showInvoice(id);
    }

  </script>
</html>
